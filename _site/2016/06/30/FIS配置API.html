<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Fis配置api</title>
  <meta name="description" content="零配置">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://github.com/BETH-zhang/2016/06/30/FIS%E9%85%8D%E7%BD%AEAPI.html">
  <link rel="alternate" type="application/rss+xml" title="前端花园" href="https://github.com/BETH-zhang/feed.xml">
  <link type="image/x-icon" rel="shortcut icon" href="https://raw.githubusercontent.com/BETH-zhang/Frontend-Garden/gh-pages/_includes/favicon.ico">
  <script type="text/javascript" src="/js/jquery.min.js"></script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">前端花园</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Fis配置api</h1>
    <p class="post-meta"><a href="https://github.com/BETH-zhang" target="_blank"/><img class="post-avatar" src="https://avatars3.githubusercontent.com/u/19342035?v=3&s=40"/></a><time datetime="2016-06-30T00:00:00+08:00" itemprop="datePublished">Jun 30, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="section">零配置</h2>

<p>不使用任何配置，fis将支持：</p>

<ul>
  <li>使用 fis install <name> 命令安装fis仓库提供的各种 组件、框架、示例、素材、配置等 开发资源。</name></li>
  <li>使用 fis server start 命令启动一个本地调试服务器，完美支持php后端程序</li>
  <li>使用 fis release –dest ./output –md5 命令为所有静态资源文件（js、css、图片、flash等）添加md5戳，并修改文件中的引用路径</li>
  <li>使用 fis release –dest ./output –optimize 命令对js、css、html、htm文件进行压缩（后续还会加上对图片的自动压缩）</li>
  <li>编译中对 js、 css 以及 类html ( html, htm, xhtml, tpl, php, jsp, asp ) 文件分别支持三种扩展语言能力：
    <ul>
      <li>资源定位：获取任何开发中所使用资源的线上路径；</li>
      <li>内容嵌入：把一个文件的内容(文本)或者base64编码(图片)嵌入到另一个文件中；</li>
      <li>依赖声明：在一个文本文件内标记对其他文件的依赖关系；</li>
    </ul>
  </li>
</ul>

<p>以上功能可满足传统前端开发所需的基本要求</p>

<h2 id="section-1">使用配置文件</h2>

<p>在项目目录下新建一个 fis-conf.js 文件，我们可以对fis的编译系统做各种定制化配置。配置fis系统的接口是：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>fis.config.set(key, value); 或者

fis.config.merge({...}); 由于fis自动化工具采用nodejs作为平台，因此其配置文件也是js书写的。fis变量是全局注册，config属性是fis系统的配置对象实例，merge或set方法用以合并配置数据。
</code></pre>
</div>

<h3 id="section-2">内置的默认配置</h3>

<p>由于fis系统是完全插件化的，因此fis.config对象会有一些内置配置用以为用户提供零配置下的基本功能，所以配置文件中使用fis.config.merge 或者 fis.config.set 接口来追加用户配置。而内部初始化的配置数是：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
    <span class="na">project</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">charset</span> <span class="p">:</span> <span class="s1">'utf8'</span><span class="p">,</span>
        <span class="na">md5Length</span> <span class="p">:</span> <span class="mi">7</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<script type="text/javascript" src="/js/H5ComponentBase.js"></script>

<h2 id="section-3">项目配置</h2>

<p>配置项 project</p>

<div style="display:none;">

<div id="charset">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.charset'</span><span class="p">,</span> <span class="s1">'gbk'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">project</span> <span class="p">:</span> <span class="p">{</span> <span class="na">charset</span> <span class="p">:</span> <span class="s1">'gbk'</span> <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="md5Length">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.md5Length'</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">project</span> <span class="p">:</span> <span class="p">{</span> <span class="na">md5Length</span> <span class="p">:</span> <span class="mi">8</span> <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="md5Connector">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.md5Connector '</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">project</span> <span class="p">:</span> <span class="p">{</span> <span class="na">md5Connector</span> <span class="p">:</span> <span class="s1">'.'</span> <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="include">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.include'</span><span class="p">,</span> <span class="s1">'src/**'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">project</span> <span class="p">:</span> <span class="p">{</span> <span class="na">include</span> <span class="p">:</span> <span class="s1">'src/**'</span> <span class="p">}</span>
<span class="p">});</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.include'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'src/**'</span><span class="p">,</span> <span class="sr">/^</span><span class="se">\/</span><span class="sr">vendor</span><span class="se">\/</span><span class="sr">/i</span><span class="p">]);</span></code></pre></figure>

</div>
<div id="exclude">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.exclude'</span><span class="p">,</span> <span class="sr">/^</span><span class="se">\/</span><span class="sr">_build</span><span class="se">\/</span><span class="sr">/i</span><span class="p">);</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">project</span> <span class="p">:</span> <span class="p">{</span> <span class="na">exclude</span> <span class="p">:</span> <span class="sr">/^</span><span class="se">\/</span><span class="sr">_build</span><span class="se">\/</span><span class="sr">/i</span> <span class="p">}</span>
<span class="p">});</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.exclude'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"dist/**"</span><span class="p">,</span> <span class="sr">/^</span><span class="se">\/</span><span class="sr">_build</span><span class="se">\/</span><span class="sr">/i</span><span class="p">]);</span></code></pre></figure>

</div>
<div id="fileType-text">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.fileType.text'</span><span class="p">,</span> <span class="s1">'tpl, js, css'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">project</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">fileType</span> <span class="p">:</span> <span class="p">{</span>
            <span class="na">text</span> <span class="p">:</span> <span class="s1">'tpl, js, css'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="fileType-image">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.fileType.image'</span><span class="p">,</span> <span class="s1">'swf, cur, ico'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">project</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">fileType</span> <span class="p">:</span> <span class="p">{</span>
            <span class="na">image</span> <span class="p">:</span> <span class="s1">'swf, cur, ico'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="watch-exclude">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.watch.exclude'</span><span class="p">,</span> <span class="s1">'node_modules'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.watch.exclude'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'node_modules'</span><span class="p">,</span> <span class="sr">/docs/</span><span class="p">]);</span></code></pre></figure>

</div>
<div id="watch-usePolling">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'project.watch.usePolling'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span></code></pre></figure>

</div>

</div>

<div id="api-list-project" class="light"></div>

<h2 id="section-4">插件配置</h2>

<p>配置项 modules</p>

<blockquote>
  <p>fis系统有非常灵活的插件扩展能力，详细内容请参看 <a href="http://fex.baidu.com/fis-site/docs/more/fis-base.html">运行原理</a>，<a href="http://fex.baidu.com/fis-site/docs/more/how-plugin-works.html">插件调用机制</a>，<a href="http://fex.baidu.com/fis-site/docs/more/extension-point.html">插件扩展点列表</a>等文档。
fis所有的插件配置都支持定义一个 数组或者逗号分隔的字符串序列 来依次处理文件内容。</p>
</blockquote>

<div id="api-list-plugin" class="light"></div>

<div style="display:none;">

<div id="parser">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">modules</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">parser</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//coffee后缀的文件使用fis-parser-coffee-script插件编译</span>
            <span class="na">coffee</span> <span class="p">:</span> <span class="s1">'coffee-script'</span><span class="p">,</span>
            <span class="c1">//less后缀的文件使用fis-parser-less插件编译</span>
            <span class="c1">//处理器支持数组，或者逗号分隔的字符串配置</span>
            <span class="na">less</span> <span class="p">:</span> <span class="p">[</span><span class="s1">'less'</span><span class="p">],</span>
            <span class="c1">//md后缀的文件使用fis-parser-marked插件编译</span>
            <span class="na">md</span> <span class="p">:</span> <span class="s1">'marked'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">roadmap</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">ext</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//less后缀的文件将输出为css后缀</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做css文件处理</span>
            <span class="na">less</span> <span class="p">:</span> <span class="s1">'css'</span><span class="p">,</span>
            <span class="c1">//coffee后缀的文件将输出为js文件</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做js文件处理</span>
            <span class="na">coffee</span> <span class="p">:</span> <span class="s1">'js'</span><span class="p">,</span>
            <span class="c1">//md后缀的文件将输出为html文件</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做html文件处理</span>
            <span class="na">md</span> <span class="p">:</span> <span class="s1">'html'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="preprocessor">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'modules.preprocessor.css'</span><span class="p">,</span> <span class="s1">'image-set'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">modules</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">preprocessor</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//css后缀文件会经过fis-preprocessor-image-set插件的预处理</span>
            <span class="na">css</span> <span class="p">:</span> <span class="s1">'image-set'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="postprocessor">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="err">类似</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">preprocessor</span></code></pre></figure>

</div>
<div id="lint">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'modules.lint.js'</span><span class="p">,</span> <span class="s1">'jshint'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">modules</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">lint</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//js后缀文件会经过fis-lint-jshint插件的代码校验检查</span>
            <span class="na">js</span> <span class="p">:</span> <span class="s1">'jshint'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="test">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'modules.test.js'</span><span class="p">,</span> <span class="s1">'phantomjs'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">modules</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">test</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//js后缀文件会经过fis-test-phantomjs插件的测试</span>
            <span class="na">js</span> <span class="p">:</span> <span class="s1">'phantomjs'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="optimizer">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'modules.optimizer.js'</span><span class="p">,</span> <span class="s1">'uglify-js'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">modules</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">optimizer</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//js后缀文件会经过fis-optimizer-uglify-js插件的压缩优化</span>
            <span class="na">js</span> <span class="p">:</span> <span class="s1">'uglify-js'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="prepackager">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'modules.prepackager'</span><span class="p">,</span> <span class="s1">'oo, xx'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">modules</span> <span class="p">:</span> <span class="p">{</span>
        <span class="c1">//打包前调用fis-prepackager-oo和fis-prepackager-xx插件进行处理</span>
        <span class="na">prepackager</span> <span class="p">:</span> <span class="s1">'oo, xx'</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="packager">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'modules.packager'</span><span class="p">,</span> <span class="s1">'your_packager'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">modules</span> <span class="p">:</span> <span class="p">{</span>
        <span class="c1">//打包调用fis-packager-your_packager插件进行处理</span>
        <span class="na">packager</span> <span class="p">:</span> <span class="s1">'your_packager'</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="spriter">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'modules.spriter'</span><span class="p">,</span> <span class="s1">'your_spriter'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">modules</span> <span class="p">:</span> <span class="p">{</span>
        <span class="c1">//打包后调用fis-spriter-your_spriter插件进行css sprites化处理</span>
        <span class="na">spriter</span> <span class="p">:</span> <span class="s1">'your_spriter'</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>
<div id="postpackager">

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'modules.postpackager'</span><span class="p">,</span> <span class="s1">'your_postpackager'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">modules</span> <span class="p">:</span> <span class="p">{</span>
        <span class="c1">//打包后调用fis-postpackager-your_postpackager插件进行处理</span>
        <span class="na">postpackager</span> <span class="p">:</span> <span class="s1">'your_postpackager'</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

</div>

</div>

<script type="text/javascript" src="/js/H5ComponentApiList.js"></script>

<h2 id="section-5">插件运行配置</h2>

<h3 id="settings">配置项 settings</h3>

<p>解释：插件的运行配置节点。
值类型：Object
默认值：无
说明：插件要工作，偶尔也需要配置数据，比如fis内置的fis-optimizer-uglify-js、fis-optimizer-clean-css，它们的配置都是fis直接传递的，具体细节可以查看相应源码。配置节点具有很强的规律性，请参考下面的例子，小编就不一一枚举了。
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'settings.optimizer.uglify-js.output.max_line_len'</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'settings.optimizer.clean-css.keepBreaks'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">settings</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">optimizer</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//fis-optimizer-uglify-js插件的配置数据</span>
            <span class="s1">'uglify-js'</span> <span class="p">:</span> <span class="p">{</span>
                <span class="na">output</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="na">max_line_len</span> <span class="p">:</span> <span class="mi">500</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="c1">//fis-optimizer-clean-css插件的配置数据</span>
            <span class="s1">'clean-css'</span> <span class="p">:</span> <span class="p">{</span>
                <span class="na">keepBreaks</span> <span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h2 id="section-6">内置插件运行配置</h2>

<h3 id="postprocessorjswrapper">postprocessor.jswrapper</h3>

<p>项目：https://github.com/fis-dev/fis-postprocessor-jswrapper
解释：用于自动包装js代码的插件。
值类型：Object
默认值：无
选项：
type：包装方式。可选值目前只有 ‘amd’，amd包装结构请参考 这里，非amd包装结构参考 这里
“template”：使用模板来定义包装结构，对template属性的设置优先级高于type属性。
wrapAll：是否包装所有js文件。默认是false，只对标记为 isMod 的文件进行包装
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'settings.postprocessor.jswrapper.template'</span><span class="p">,</span> <span class="s1">'try{ ${content} }catch(e){e.message+="${id}";throw e;}'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">settings</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">postprocessor</span> <span class="p">:</span> <span class="p">{</span>
            <span class="na">jswrapper</span> <span class="p">:</span> <span class="p">{</span>
                <span class="na">template</span> <span class="p">:</span> <span class="s1">'try{ ${content} }catch(e){ e.message += "${id}"; throw e; }'</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h3 id="optimizeruglify-js">optimizer.uglify-js</h3>

<p>项目：https://github.com/fis-dev/fis-optimizer-uglify-js
解释：uglify-js压缩器配置。fis-optimizer-uglify-js 插件内置了 uglify-js 包，并调用了它的 minify 接口，把配置选项直接传递过去。因此，fis的配置完全等价于uglify-js的minify函数所需的配置
值类型：Object
默认值：无
选项：
mangle：混淆控制，参看uglify-js文档 mangle 部分
output：输出控制，参看uglify-js文档 codegen 部分
compress：优化参数，参看uglify-js文档 compress 部分
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//配置字符串全部转换为ascii字符</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'settings.optimizer.uglify-js.output.ascii_only'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//配置字符串全部转换为ascii字符</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">settings</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">optimizer</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s1">'uglify-js'</span> <span class="p">:</span> <span class="p">{</span>
                <span class="na">output</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="na">ascii_only</span> <span class="p">:</span> <span class="kc">true</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h3 id="optimizerclean-css">optimizer.clean-css</h3>

<p>项目：https://github.com/fis-dev/fis-optimizer-clean-css
解释：clean-css压缩器配置。fis-optimizer-clean-css 插件调用 clean-css 的压缩接口进行压缩，fis负责把 settings.optimizer.clean-css 配置节点的数据传递给压缩器，因此，这里的配置完全等价于clean-css的运行配置。
值类型：Object
默认值：无
选项：参看clean-css的 文档
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//配置压缩css时保留换行</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'settings.optimizer.clean-css.keepBreaks'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//配置压缩css时保留换行</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">settings</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">optimizer</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s1">'clean-css'</span> <span class="p">:</span> <span class="p">{</span>
                <span class="na">keepBreaks</span> <span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h3 id="optimizerpng-compressor">optimizer.png-compressor</h3>

<p>项目：https://github.com/fis-dev/fis-optimizer-png-compressor
解释：png图片压缩器运行配置。fis团队将 pngquant 和 pngcrush 两个优秀的png图片压缩工具移植为nodejs的原生扩展（node-pngcrush与node-pngquant-native），相比同类型工具采用进程调用的方式更高性能，压缩速度更快。
值类型：Object
默认值：无
选项：
type：选择压缩器类型，默认是 ‘pngcrush’，可选值为 ‘pngquant’，pngquant会将所有 png24 的图片压缩为 png8，压缩率极高，但alpha通道信息会有损失。
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//使用pngquant进行压缩，png图片压缩后均为png8</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'settings.optimizer.png-compressor.type'</span><span class="p">,</span> <span class="s1">'pngquant'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//使用pngquant进行压缩，png图片压缩后均为png8</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">settings</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">optimizer</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s1">'png-compressor'</span> <span class="p">:</span> <span class="p">{</span>
                <span class="na">type</span> <span class="p">:</span> <span class="s1">'pngquant'</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h3 id="spritercsssprites">spriter.csssprites</h3>

<p>项目：https://github.com/fis-dev/fis-spriter-csssprites
解释：csssprite处理运行配置，以css文件为单位，对其引用的png、gif、jpg、jpeg等图片进行csssprite合并处理。@zhangyuanwei 同学将常用图片处理库的c++版本移植为nodejs的原生扩展，得到npm包 node-images，fis团队在此基础上进行包装，开发出了这款十分易用的csssprite插件。
值类型：Object
默认值：</p>

<p>{
    margin       : 3,
    layout       : ‘linear’,
    width_limit  : 10240,
    height_limit : 10240
}
选项：</p>

<p>margin：图之间的边距，单位像素。
layout：布局算法，默认是 ‘linear’，图片垂直布局，水平方向无需 遮盖处理 。可选项还有 matrix，图片矩阵布局，面积最小化，但需要提供额外的dom控制水平方向图片的遮盖处理
注意：使用csssprite需要满足以下条件</p>

<p>使用release命令时，添加 -p 或者 –pack 参数。由于csssprite处理需要消耗一定的计算资源，并且开发过程中并不需要时刻做图片合并，因此fis将其定义为打包处理流程，启动csssprite处理需要指定–pack参数。
只有 打包的css文件 或者 roadmap.path 中 useSprite 属性标记为 true 的文件才会进行csssprite处理，因此请合理安排要进行csssprite处理的文件，尽量对合并后的文件做处理。
在css中引用图片时，只要加上 ?__sprite 这个query标记就可以使用csssprite了。详情请参考fis-spriter-csssprites插件的 使用文档。
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//使用矩阵布局</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'settings.spriter.csssprites.layout'</span><span class="p">,</span> <span class="s1">'matrix'</span><span class="p">);</span>
<span class="err">或者</span>

<span class="c1">//使用矩阵布局</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">settings</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">spriter</span> <span class="p">:</span> <span class="p">{</span>
            <span class="na">csssprites</span> <span class="p">:</span> <span class="p">{</span>
                <span class="na">layout</span> <span class="p">:</span> <span class="s1">'matrix'</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h2 id="section-7">目录规范与域名配置</h2>

<h2 id="roadmap">配置项 roadmap</h2>

<h3 id="roadmappath">roadmap.path</h3>

<p>解释：定制项目文件属性，包括但不限于 产出路径，访问url，资源id，默认依赖，文件类型。
值类型：Array
默认值：无
说明：roadmap.path配置是fis编译系中非常核心的机制，使用它可以控制文件编译后发布的路径或访问的url、操纵文件属性、为fis产出的资源表添加扩展信息，它的 实现原理 也很简单：当fis创建一个内部的 file对象 时，会利用roadmap.path来匹配文件路径，如果命中，则将当前规则下的属性及其值赋给file对象，从而影响file对象的相关信息(发布路径、访问url、资源表属性等)。roadmap.path是fis系统中资源定位的核心能力，具有非常重要的意义。由于fis自动化工具接管了js、css和类html语言的 资源定位能力，因此，用户在开发时只需使用相对路径对资源进行引用，fis编译时会根据roadmap.path的配置调整引用内容，并将代码产出到配置指定的位置，一切都配合的非常完美！
支持的配置项：
reg：用于匹配文件路径的正则(RegExp)或通配(String)。文件路径是相对项目根目录的路径，以 / 开头。
release：设置文件的产出路径。默认是文件相对项目根目录的路径，以 / 开头。该值可以设置为 false ，表示为不产出（unreleasable）文件。
url：指定文件的资源定位路径，以 / 开头。默认是 release 的值，url可以与发布路径 release 不一致。
query：指定文件的资源定位路径之后的query，比如’?t=123124132’。
id：指定文件的资源id。默认是 namespace + subpath 的值。
charset：指定文本文件的输出编码。默认是 utf8，可以制定为 gbk 或 gb2312等。
isHtmlLike：指定对文件进行html相关的 语言能力扩展
isJsLike：指定对文件进行js相关的 语言能力扩展
isCssLike：指定对文件进行css相关的 语言能力扩展
useCompile：指定文件是否经过fis的编译处理，如果为false，则该文件不会做任何编译处理。
useHash：指定文件产出后是否添加md5戳。默认只有js、css、图片文件会添加。
useDomain：指定文件引用处是否添加域名。
useCache：指定文件编译过程中是否创建缓存，默认值是 true。
useMap：指定fis在打包阶段是否将文件加入到map.json中索引。默认只有isJsLike、isCssLike、isMod的文件会加入表中
useParser：指定文件是否经过parser插件处理。默认为true，值为 false 时才会关闭。
usePreprocessor：指定文件是否经过preprocessor插件处理。默认为true，值为 false 时才会关闭。
useStandard：指定文件是否经过内置的三种语言标准化流程处理。默认为true，值为 false 时才会关闭。
usePostprocessor：指定文件是否经过postprocessor插件处理。默认为true，值为 false 时才会关闭。
useLint：指定文件是否经过lint插件处理。默认为true，值为 false 时才会关闭。
useTest：指定文件是否经过test插件处理。默认为true，值为 false 时才会关闭。
useOptimizer：指定文件是否经过optimizer插件处理
useSprite：指定文件是否进行csssprite处理。默认是 false，即不对单个文件进行csssprite操作的，而只对合并后的文件进行。fis release中使用 –pack 参数即可触发csssprite操作。
isMod：标记文件为组件化文件。被标记成组件化的文件会入map.json表。并且会对js文件进行组件化包装。
extras：在map.json中的附加数据，用于扩展map.json表的功能。
requires：默认依赖的资源id表，类型为Array。
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">roadmap</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">path</span> <span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="c1">//所有widget目录下的js文件</span>
                <span class="na">reg</span> <span class="p">:</span> <span class="s1">'widget/**.js'</span><span class="p">,</span>
                <span class="c1">//是模块化的js文件（标记为这种值的文件，会进行amd或者闭包包装）</span>
                <span class="na">isMod</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="c1">//默认依赖lib.js</span>
                <span class="na">requires</span> <span class="p">:</span> <span class="p">[</span> <span class="s1">'lib.js'</span> <span class="p">],</span>
                <span class="c1">//向产出的map.json文件里附加一些信息</span>
                <span class="na">extras</span> <span class="p">:</span> <span class="p">{</span> <span class="na">say</span> <span class="p">:</span> <span class="s1">'123'</span> <span class="p">},</span>
                <span class="c1">//编译后产出到 /static/widget/xxx 目录下</span>
                <span class="na">release</span> <span class="p">:</span> <span class="s1">'/static$&amp;'</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//所有的js文件</span>
                <span class="na">reg</span> <span class="p">:</span> <span class="s1">'**.js'</span><span class="p">,</span>
                <span class="c1">//发布到/static/js/xxx目录下</span>
                <span class="na">release</span> <span class="p">:</span> <span class="s1">'/static/js$&amp;'</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//所有的ico文件</span>
                <span class="na">reg</span> <span class="p">:</span> <span class="s1">'**.ico'</span><span class="p">,</span>
                <span class="c1">//发布的时候即使加了--md5参数也不要生成带md5戳的文件</span>
                <span class="na">useHash</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="c1">//发布到/static/xxx目录下</span>
                <span class="na">release</span> <span class="p">:</span> <span class="s1">'/static$&amp;'</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//所有image目录下的.png，.gif文件</span>
                <span class="na">reg</span> <span class="p">:</span> <span class="sr">/^</span><span class="se">\/</span><span class="sr">images</span><span class="se">\/(</span><span class="sr">.*</span><span class="se">\.(?:</span><span class="sr">png|gif</span><span class="se">))</span><span class="sr">/i</span><span class="p">,</span>
                <span class="c1">//访问这些图片的url是 '/m/xxxx?log_id=123'</span>
                <span class="na">url</span> <span class="p">:</span> <span class="s1">'/m/$1?log_id=123'</span><span class="p">,</span>
                <span class="c1">//发布到/static/pic/xxx目录下</span>
                <span class="na">release</span> <span class="p">:</span> <span class="s1">'/static/pic/$1'</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//所有template目录下的.php文件</span>
                <span class="na">reg</span> <span class="p">:</span> <span class="sr">/^</span><span class="se">\/</span><span class="sr">template</span><span class="se">\/(</span><span class="sr">.*</span><span class="se">\.</span><span class="sr">php</span><span class="se">)</span><span class="sr">/i</span><span class="p">,</span>
                <span class="c1">//是类html文件，会进行html语言能力扩展</span>
                <span class="na">isHtmlLike</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="c1">//发布为gbk编码文件</span>
                <span class="na">charset</span> <span class="p">:</span> <span class="s1">'gbk'</span><span class="p">,</span>
                <span class="c1">//发布到/php/template/xxx目录下</span>
                <span class="na">release</span> <span class="p">:</span> <span class="s1">'/php/template/$1'</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//前面规则未匹配到的其他文件</span>
                <span class="na">reg</span> <span class="p">:</span> <span class="sr">/.*/</span><span class="p">,</span>
                <span class="c1">//编译的时候不要产出了</span>
                <span class="na">release</span> <span class="p">:</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h3 id="roadmapext">roadmap.ext</h3>

<p>解释：指定后缀名与标准化语言的映射关系。
值类型：Object
默认值：无
说明：fis允许在前端开发中使用less、coffee、utc等非标准语言，并能利用插件将它们编译成标准的js、css语言。这个过程是由modules.parser配置的插件处理的。编译之后，less会变成css文件，那么，后续对于css的处理应该同样可以适用于less的生成文件，因此，这个时候需要通过配置告诉fis，less文件会编译为css文件，并在后续的处理过程中当做css文件对待。
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">roadmap</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">ext</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//less后缀的文件将输出为css后缀</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做css文件处理</span>
            <span class="na">less</span> <span class="p">:</span> <span class="s1">'css'</span><span class="p">,</span>
            <span class="c1">//coffee后缀的文件将输出为js文件</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做js文件处理</span>
            <span class="na">coffee</span> <span class="p">:</span> <span class="s1">'js'</span><span class="p">,</span>
            <span class="c1">//md后缀的文件将输出为html文件</span>
            <span class="c1">//并且在parser之后的其他处理流程中被当做html文件处理</span>
            <span class="na">md</span> <span class="p">:</span> <span class="s1">'html'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h3 id="roadmapdomain">roadmap.domain</h3>

<p>解释：设置静态资源的域名前缀。
值类型：Object | string
默认值：无
说明：fis扩展了html、js、css的三种语言能力，并支持对资源的定位，定位包括 开发路径与发布路径的映射关系 以及 静态资源服务器域名设置。roadmap.domain节点就是用于控制该能力的配置。
注意：domain的值如果不是特殊需要，请 不要以”/”结尾。
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//fis-conf.js</span>
<span class="c1">//用法一</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">roadmap</span> <span class="p">:</span> <span class="p">{</span>
        <span class="c1">//所有静态资源文件都使用 http://s1.example.com 或者 http://s2.example.com 作为域名</span>
        <span class="na">domain</span> <span class="p">:</span> <span class="s1">'http://s1.example.com, http://s2.example.com'</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="c1">//用法二</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">roadmap</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">domain</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//widget目录下的所有css文件使用 http://css1.example.com 作为域名</span>
            <span class="s1">'widget/**.css'</span> <span class="p">:</span> <span class="s1">'http://css1.example.com'</span><span class="p">,</span>
            <span class="c1">//所有的js文件使用 http://js1.example.com 或者  http://js2.example.com 作为域名</span>
            <span class="s1">'**.js'</span> <span class="p">:</span> <span class="p">[</span><span class="s1">'http://js1.example.com'</span><span class="p">,</span> <span class="s1">'http://js2.example.com'</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>编译时使用fis release的 –domains 参数来控制是否添加domain</p>

<div class="highlighter-rouge"><pre class="highlight"><code>fis release --domains --dest ../output ### roadmap.domain.image
</code></pre>
</div>

<p>解释：设置图片资源的域名前缀。
值类型：Array | string
默认值：无
说明：由于使用配置roadmap.domain.ext方式来配置图片资源太麻烦，fis提供了image字段，对于符合 project.fileType.image 规则的文件，设置相应domain配置。
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">roadmap</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">domain</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//所有图片文件，使用 http://img.example.com 作为域名</span>
            <span class="s1">'image'</span> <span class="p">:</span> <span class="p">[</span><span class="s1">'http://img.example.com'</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>编译时使用fis release的 –domains 参数来控制是否添加domain</p>

<div class="highlighter-rouge"><pre class="highlight"><code>fis release --domains --dest ../output
</code></pre>
</div>

<h2 id="section-8">部署配置</h2>

<h3 id="deploy">配置项 deploy</h3>

<p>解释：设置项目的发布方式。
值类型：Object
默认值：无
说明：当使用 fis release 命令时，参数 –dest <name> 可以指定项目发布配置。deploy配置是一个key-value的object对象，--dest参数的值如果与配置的key相同，则执行该配置的部署设置。fis支持使用post请求向http服务器发送文件，服务器端可以使用php、java等后端逻辑进行接收，fis-command-release插件中提供了一个这样的 php版示例，用户可以直接部署此文件于接收端服务器上。
用法：</name></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">deploy</span> <span class="p">:</span> <span class="p">{</span>
        <span class="c1">//使用fis release --dest remote来使用这个配置</span>
        <span class="na">remote</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//如果配置了receiver，fis会把文件逐个post到接收端上</span>
            <span class="na">receiver</span> <span class="p">:</span> <span class="s1">'http://www.example.com/path/to/receiver.php'</span><span class="p">,</span>
            <span class="c1">//从产出的结果的static目录下找文件</span>
            <span class="na">from</span> <span class="p">:</span> <span class="s1">'/static'</span><span class="p">,</span>
            <span class="c1">//保存到远端机器的/home/fis/www/static目录下</span>
            <span class="c1">//这个参数会跟随post请求一起发送</span>
            <span class="na">to</span> <span class="p">:</span> <span class="s1">'/home/fis/www/'</span><span class="p">,</span>
            <span class="c1">//通配或正则过滤文件，表示只上传所有的js文件</span>
            <span class="na">include</span> <span class="p">:</span> <span class="s1">'**.js'</span><span class="p">,</span>
            <span class="c1">//widget目录下的那些文件就不要发布了</span>
            <span class="na">exclude</span> <span class="p">:</span> <span class="sr">/</span><span class="se">\/</span><span class="sr">widget</span><span class="se">\/</span><span class="sr">/i</span><span class="p">,</span>
            <span class="c1">//支持对文件进行字符串替换</span>
            <span class="na">replace</span> <span class="p">:</span> <span class="p">{</span>
                <span class="na">from</span> <span class="p">:</span> <span class="s1">'http://www.online.com'</span><span class="p">,</span>
                <span class="na">to</span> <span class="p">:</span> <span class="s1">'http://www.offline.com'</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="c1">//名字随便取的，没有特殊含义</span>
        <span class="na">local</span> <span class="p">:</span> <span class="p">{</span>
            <span class="c1">//from参数省略，表示从发布后的根目录开始上传</span>
            <span class="c1">//发布到当前项目的上一级的output目录中</span>
            <span class="na">to</span> <span class="p">:</span> <span class="s1">'../output'</span>
        <span class="p">},</span>
        <span class="c1">//也可以是一个数组</span>
        <span class="na">remote2</span> <span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="c1">//将static目录上传到/home/fis/www/webroot下</span>
                <span class="c1">//上传文件路径为/home/fis/www/webroot/static/xxxx</span>
                <span class="na">receiver</span> <span class="p">:</span> <span class="s1">'http://www.example.com/path/to/receiver.php'</span><span class="p">,</span>
                <span class="na">from</span> <span class="p">:</span> <span class="s1">'/static'</span><span class="p">,</span>
                <span class="na">to</span> <span class="p">:</span> <span class="s1">'/home/fis/www/webroot'</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="c1">//将template目录内的文件（不包括template一级）</span>
                <span class="c1">//上传到/home/fis/www/tpl下</span>
                <span class="c1">//上传文件路径为/home/fis/www/tpl/xxxx</span>
                <span class="na">receiver</span> <span class="p">:</span> <span class="s1">'http://www.example.com/path/to/receiver.php'</span><span class="p">,</span>
                <span class="na">from</span> <span class="p">:</span> <span class="s1">'/template'</span><span class="p">,</span>
                <span class="na">to</span> <span class="p">:</span> <span class="s1">'/home/fis/www/tpl'</span><span class="p">,</span>
                <span class="na">subOnly</span> <span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>小贴士：</p>

<p>–dest参数 支持使用逗号（,）分割多个发布配置，比如上面的例子，我们可以使用fis release –dest remote,plugin 命令在一次编译中同时发布多个目标。</p>

<p>subOnly参数 默认上传from整个目录到测试机。添加subOnly参数仅上传from目录下文件。</p>

<p>replace替换多个字符串 需要replace替换多个字符串，可以使用正则的方式。例如：</p>

<p>replace : {
    from : /www.a.com|www.b.com/,
    to : function(m){
        if(m === ‘www.a.com’) return ‘www.x.com’;
        if(m === ‘www.b.com’) return ‘www.y.com’;
    }
}
deploy 扩展</p>

<p>通过 deploy扩展 能力，用户可以自定义 fis 的产出功能，更方便的实现自动化部署功能。目前官方提供的 deploy扩展 有</p>

<p>tar
git
bcs</p>

<p>此外还有社区贡献的如</p>

<p>aliyun
zip
ftp</p>

<p>使用 deploy扩展 的方法与使用 fis 插件的方法类似</p>

<p>用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 设置开启deploy扩展，可以输入数组来开启多个扩展</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'modules.deploy'</span><span class="p">,</span> <span class="s1">'tar'</span><span class="p">);</span>

<span class="c1">// 为指定扩展设置发布配置</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'settings.deploy.tar'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">publish</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">from</span> <span class="p">:</span> <span class="s1">'/'</span><span class="p">,</span>
        <span class="na">to</span><span class="p">:</span> <span class="s1">'/'</span><span class="p">,</span>
        <span class="na">gzip</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">level</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">//压缩质量 0-9，越大压缩比越高</span>
        <span class="na">memLevel</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="c1">//压缩使用的内存量 1-9， 越大占用内存越多，执行速度越快</span>
        <span class="na">file</span><span class="p">:</span> <span class="s1">'./output/output.tar.gz'</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h1 id="outputoutputtargz">发布至output/output.tar.gz</h1>
<p>fis release -d publish</p>

<h2 id="section-9">打包配置</h2>

<h3 id="pack">配置项 pack</h3>

<p>解释：配置要打包合并的文件。
值类型：Object
默认值：无
说明：fis内置的 打包策略 与传统的打包概念不同，fis的打包实际上是在建立一个资源表，并将其描述并产出为一份map.json文件，用户应该围绕着这份描述文件来设计前后端运行框架，从而实现运行时判断打包输出策略的架构。
用法：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">pack</span> <span class="p">:</span> <span class="p">{</span>
        <span class="c1">//打包所有的demo.js, script.js文件</span>
        <span class="c1">//将内容输出为static/pkg/aio.js文件</span>
        <span class="s1">'pkg/aio.js'</span> <span class="p">:</span> <span class="p">[</span><span class="s1">'**/demo.js'</span><span class="p">,</span> <span class="sr">/</span><span class="se">\/</span><span class="sr">script</span><span class="se">\.</span><span class="sr">js$/i</span><span class="p">],</span>
        <span class="c1">//打包所有的css文件</span>
        <span class="c1">//将内容输出为static/pkg/aio.css文件</span>
        <span class="s1">'pkg/aio.css'</span> <span class="p">:</span> <span class="s1">'**.css'</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>输出结果：使用命令</p>

<div class="highlighter-rouge"><pre class="highlight"><code>fis release --pack --md5 --dest ./output 
</code></pre>
</div>

<p>编译项目，然后到output目录下查看产出的map.json内容得到：</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
    <span class="s2">"res"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"demo.css"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"uri"</span><span class="err">:</span> <span class="s2">"/static/css/demo_7defa41.css"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"css"</span><span class="p">,</span>
            <span class="s2">"pkg"</span><span class="err">:</span> <span class="s2">"p1"</span>
        <span class="p">},</span>
        <span class="s2">"demo.js"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"uri"</span><span class="err">:</span> <span class="s2">"/static/js/demo_33c5143.js"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"js"</span><span class="p">,</span>
            <span class="s2">"deps"</span><span class="err">:</span> <span class="p">[</span>
                <span class="s2">"demo.css"</span>
            <span class="p">],</span>
            <span class="s2">"pkg"</span><span class="err">:</span> <span class="s2">"p0"</span>
        <span class="p">},</span>
        <span class="s2">"index.html"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"uri"</span><span class="err">:</span> <span class="s2">"/index.html"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"html"</span><span class="p">,</span>
            <span class="s2">"deps"</span><span class="err">:</span> <span class="p">[</span>
                <span class="s2">"demo.js"</span><span class="p">,</span>
                <span class="s2">"demo.css"</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"script.js"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"uri"</span><span class="err">:</span> <span class="s2">"/static/js/script_32300bf.js"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"js"</span><span class="p">,</span>
            <span class="s2">"pkg"</span><span class="err">:</span> <span class="s2">"p0"</span>
        <span class="p">},</span>
        <span class="s2">"style.css"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"uri"</span><span class="err">:</span> <span class="s2">"/static/css/style_837b297.css"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"css"</span><span class="p">,</span>
            <span class="s2">"pkg"</span><span class="err">:</span> <span class="s2">"p1"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">"pkg"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"p0"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"uri"</span><span class="err">:</span> <span class="s2">"/static/pkg/aio_5bb04ef.js"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"js"</span><span class="p">,</span>
            <span class="s2">"has"</span><span class="err">:</span> <span class="p">[</span>
                <span class="s2">"demo.js"</span><span class="p">,</span>
                <span class="s2">"script.js"</span>
            <span class="p">],</span>
            <span class="s2">"deps"</span><span class="err">:</span> <span class="p">[</span>
                <span class="s2">"demo.css"</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"p1"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"uri"</span><span class="err">:</span> <span class="s2">"/static/pkg/aio_cdf8bd3.css"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"css"</span><span class="p">,</span>
            <span class="s2">"has"</span><span class="err">:</span> <span class="p">[</span>
                <span class="s2">"demo.css"</span><span class="p">,</span>
                <span class="s2">"style.css"</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>


  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">前端花园</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li><a href="mailto:gemeiwangji789@qq.com">gemeiwangji789@qq.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/BETH-zhang"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">BETH-zhang</span></a>

          </li>
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>在前端的道路上风景更加绚丽多姿</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
